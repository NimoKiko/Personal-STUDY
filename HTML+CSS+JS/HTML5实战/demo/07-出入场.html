<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- 分辨率范围：1200 ~ 2000 -->
    <link rel="stylesheet" href="./css/css.css" />
  </head>
  <body>
    <section id="wrap">
      <!-- 流体布局 -->
      <header id="head">
        <!-- 固定布局 -->
        <div class="headMain">
          <h1 class="logo">
            <a href="javascript:;">
              <img class="logoImg" src="./img/logo.png" alt="" />
            </a>
          </h1>
          <nav class="nav">
            <ul class="list">
              <li>
                <a href="javascript:;">
                  <div class="up">
                    <img
                      style="width: 20px; height: 20px"
                      src="./img/home_black.png"
                      alt=""
                    />
                  </div>
                  <div class="down">
                    <img
                      style="width: 20px; height: 20px"
                      src="./img/home_blue.png"
                      alt=""
                    />
                  </div>
                </a>
              </li>
              <li>
                <a href="javascript:;">
                  <div class="up">Course</div>
                  <div class="down">Course</div>
                </a>
              </li>
              <li>
                <a href="javascript:;">
                  <div class="up">Works</div>
                  <div class="down">Works</div>
                </a>
              </li>
              <li>
                <a href="javascript:;">
                  <div class="up">About</div>
                  <div class="down">About</div>
                </a>
              </li>
              <li>
                <a href="javascript:;">
                  <div class="up">Team</div>
                  <div class="down">Team</div>
                </a>
              </li>
            </ul>
          </nav>
          <div class="arrow">
            <img src="./img//jiantou.png" alt="" />
          </div>
        </div>
      </header>
      <section id="content">
        <ul class="list">
          <!-- 第一屏 -->
          <li class="home">
            <section style="background: transparent">
              <ul class="home1">
                <li class="active">
                  <div class="item commonTitle"></div>
                </li>
                <li>
                  <div class="item commonTitle"></div>
                </li>
                <li>
                  <div class="item commonTitle"></div>
                </li>
                <li>
                  <div class="item commonTitle"></div>
                </li>
              </ul>
              <ul class="home2">
                <li class="active"></li>
                <li></li>
                <li></li>
                <li></li>
              </ul>
            </section>
          </li>
          <!-- 第二屏 -->
          <li class="Course">
            <section>
              <header class="course1 commonTitle">
                <span>阴阳师</span> <br />
                <span>六周年庆</span> <br />
                <span>星守千年</span> <br />
              </header>
              <div class="course2 commonText">
                <p class="commonText">
                  以世间的花,蛇为灵感,以青色为主，更能够突出清姬的淡雅与幽静。蛇的受伤如同清姬心中的伤痕。
                </p>
                <p class="commonText" style="margin-top: 20px">
                  这世间的百花,总能让清姬回顾之前与他共度的美好时光。还有那如影随形的头骨，仿佛他从未离开过一般。如果有人想抢夺她手中的头骨，她会毫不留情的让他从这世上消失，挫骨扬灰。
                </p>
              </div>
              <div class="course3">
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
                <div class="item">
                  <div class="face"></div>
                  <div class="backFace">缚骨清姬</div>
                </div>
              </div>
            </section>
          </li>
          <!-- 第三屏 -->
          <li class="Works">
            <section>
              <header class="works1 commonTitle">
                <span>阴阳师</span> <br />
                <span>六周年庆</span> <br />
                <span>星守千年</span> <br />
              </header>
              <div class="list">
                <div class="item">
                  <img src="./img/page3_01.png" alt="" />
                  <div class="mask">
                    <span>测试文字</span>
                    <div class="icon"></div>
                  </div>
                </div>
                <div class="item">
                  <img src="./img/page3_02.png" alt="" />
                  <div class="mask">
                    <span>测试文字</span>
                    <div class="icon"></div>
                  </div>
                </div>
                <div class="item">
                  <img src="./img/page3_03.png" alt="" />
                  <div class="mask">
                    <span>测试文字</span>
                    <div class="icon"></div>
                  </div>
                </div>
                <div class="item">
                  <img style="width: 360px" src="./img/page3_04.png" alt="" />
                  <div class="mask">
                    <span>测试文字</span>
                    <div class="icon"></div>
                  </div>
                </div>
              </div>
              <div class="robot"><img src="./img/qingji.png" alt="" /></div>
            </section>
          </li>
          <!-- 第四屏 -->
          <li class="About">
            <section>
              <header class="about1 commonTitle">
                <span>阴阳师</span> <br />
                <span>六周年庆</span> <br />
                <span>SSR须佐之男</span> <br />
              </header>
              <div class="about2">
                <p class="commonText">
                  高天原三贵子中的处刑之神、掌控天雷万象的武神之首。数千年前的七恶神之战中，须佐之男率高天原神军，与天照一同镇压了七恶神，并在高天原审判上以天羽羽斩封印八岐大蛇。神明本是高贵的灵魂，是旁观者，但须佐之男选择走下神坛，为世人承受苦难；有行刑者之名，却以行刑的方式，守护着他所爱的人们和世界。即使再过千年万年，即使世界变了模样，须佐之男也仍会为我们而战。
                </p>
              </div>
              <div class="about3">
                <div class="item">
                  <div></div>
                  <ul data-src="./img/page04-01.png"></ul>
                </div>
                <div class="item">
                  <div></div>
                  <ul data-src="./img/page04-04.png"></ul>
                </div>
              </div>
              <!-- <div class="about4"></div> -->
            </section>
          </li>
          <!-- 第五屏 -->
          <li class="Team">
            <section>
              <header class="team1 commonTitle">
                <span>阴阳师</span> <br />
                <span>六周年庆</span> <br />
                <span>SP神启荒</span> <br />
              </header>
              <div class="team2">
                <p class="commonText">
                  「老师，请教教我，如何才能找到那颗属于自己的星？」陷入迷茫的少年向月海之主寻求答案，却没有得到确切的回复。
                  　　「世人寻觅是因他们对未知充满恐惧。而你不一样，荒，你是我最优秀的弟子。你应当比谁都清楚，天命不可违。」
                  　　—— 真的，是这样吗？
                </p>
                <p class="commonText">
                  「天命不可违，荒，你要谨记。」月读的告诫在耳畔反复萦绕不散，如同试图刻入脑海的咒语，阻挡着他寻求内心答案的脚步。少年神使终于打破那道无形的桎梏，自心底发出长久以来的质疑——「天命，真的不可违吗？」
                </p>
              </div>
              <ul class="team3">
                <li></li>
                <li></li>
                <li></li>
                <li></li>
              </ul>
            </section>
          </li>
        </ul>
        <ul class="dot">
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
        </ul>
      </section>
    </section>
  </body>
  <script>
    window.onload = function () {
      // 获取dom元素
      // 获取箭头的dom
      var arrow = document.querySelector("#head .headMain > .arrow");
      // 获取全部的屏幕右侧圆点li节点
      var dotList = document.querySelectorAll("#content > .dot > li");
      // 获取li的dom
      var liNodes = document.querySelectorAll(
        "#head .headMain > .nav > .list > li"
      );
      // 获取移到li上时的样式的dom
      var upNodes = document.querySelectorAll(
        "#head .headMain > .nav > .list > li .up"
      );
      // 获取第一个li节点
      var firstLiNode = liNodes[0];
      // 获取第一个up节点
      var firstUpNode = firstLiNode.querySelector(".up");
      // 获取头部节点
      var head = document.querySelector("#head");
      // 获取内容区节点
      var content = document.querySelector("#content");
      // 获取每一屏的内容区节点
      var cLiNodes = document.querySelectorAll("#content > .list > li");
      // 获取每一屏的节点
      var cList = document.querySelector("#content .list");
      // 获取第一屏小圆点的DOM节点
      var home2LiNodes = document.querySelectorAll(
        "#content > .list > .home .home2 > li"
      );
      // 获取第一屏需要切换的轮播图DOM节点
      var home1LiNodes = document.querySelectorAll(
        "#content > .list > .home .home1 > li"
      );
      var home1 = document.querySelector("#content > .list > .home .home1");
      var home2 = document.querySelector("#content > .list > .home .home2");
      // 获取第四屏存放两张图片的ul节点
      var about3UlLists = document.querySelectorAll(
        "#content > .list > .About .about3 > .item > ul"
      );
      // 获取第五屏的section区域节点
      var teamS = document.querySelector("#content > .list > .Team > section");
      // 获取第五屏图像的元素
      var picListNodes = document.querySelectorAll(
        "#content > .list > .Team .team3 > li"
      );
      // 获取第五屏装图片列表的容器
      var team3 = document.querySelector("#content > .list > .Team .team3");
      // 同步当前屏的索引
      var now = 0;
      // 定时器
      var timer = 0;
      // 气泡函数中的两个定时器
      var timer1 = 0;
      var timer2 = 0;

      // 上一屏
      var preI = 0;

      // 08-出入场
      var animation = [
        {
          inAn: function () {
            home1.style.transform = "translateY(0px)";
            home1.style.opacity = 1;
            home2.style.transform = "translateY(0px";
            home2.style.opacity = 1;
          },
          outAn: function () {
            home1.style.transform = "translateY(-400px)";
            home1.style.opacity = 0;
            home2.style.transform = "translateY(200px";
            home2.style.opacity = 0;
          },
        },
        {
          inAn: function () {},
          outAn: function () {},
        },
        {
          inAn: function () {},
          outAn: function () {},
        },
        {
          inAn: function () {
            var picUl1 = document.querySelector(
              "#content > .list > .About .about3 > .item:nth-of-type(1)"
            );
            var picUl2 = document.querySelector(
              "#content > .list > .About .about3 > .item:nth-of-type(2)"
            );

            picUl1.style.transform = "rotate(0deg)";
            picUl2.style.transform = "rotate(0deg)";
          },
          outAn: function () {
            var picUl1 = document.querySelector(
              "#content > .list > .About .about3 > .item:nth-of-type(1)"
            );
            var picUl2 = document.querySelector(
              "#content > .list > .About .about3 > .item:nth-of-type(2)"
            );

            picUl1.style.transform = "rotate(360deg)";
            picUl2.style.transform = "rotate(360deg)";
          },
        },
        {
          inAn: function () {
            var team1 = document.querySelector("#content > .list > .Team .team1");
            var team2 = document.querySelector("#content > .list > .Team .team2");

            team1.style.transform = "translateX(0px)"
            team1.style.opacity = 1;
            team2.style.transform = "translateX(0px)"
            team2.style.opacity = 1;
          },
          outAn: function () {
            var team1 = document.querySelector("#content > .list > .Team .team1");
            var team2 = document.querySelector("#content > .list > .Team .team2");

            team1.style.transform = "translateX(-600px)"
            team1.style.opacity = 0;
            team2.style.transform = "translateX(700px)"
            team2.style.opacity = 0;
          },
        },
      ];

      for(let i = 0 ; i < animation.length ; i++ ){
        animation[i]["outAn"]();
      }
      setTimeout(()=>{
        animation[0].inAn();
      },1000)

      // 07-第五屏交互效果
      bubble();
      function bubble() {
        var oc = null;
        for (let i = 0; i < picListNodes.length; i++) {
          // 设置鼠标移入的效果
          picListNodes[i].onmouseenter = function () {
            // 设置透明度（移入时其他元素半透明）
            for (let i = 0; i < picListNodes.length; i++) {
              picListNodes[i].style.opacity = ".5";
            }
            this.style.opacity = "1";
            addCanvas();
            oc.onmouseleave = function () {
              for (let i = 0; i < picListNodes.length; i++) {
                picListNodes[i].style.opacity = 1;
              }

              // 移除canvas
              removeCanvas();
            };
            oc.style.left = this.offsetLeft + 312 / 2 + "px";
          };
        }

        // 创建canvas的函数
        function addCanvas() {
          if (!oc) {
            oc = document.createElement("canvas");
            oc.width = picListNodes[0].offsetWidth;
            oc.height = picListNodes[0].offsetHeight;

            teamS.appendChild(oc);
            qiPao();
          }
        }

        // 创建canvas移除函数
        function removeCanvas() {
          oc.remove();
          oc = null;
          clearInterval(timer1);
          clearInterval(timer2);
        }

        // 气泡特效函数
        function qiPao() {
          if (oc.getContext) {
            var ctx = oc.getContext("2d");

            // 一个用来存储圆的数组
            var arr = [];
            // 生成圆的信息
            timer1 = setInterval(() => {
              // 设置一些基础圆的信息
              var x = Math.round(Math.random() * oc.width);
              var y = Math.round(Math.random() * 30) + 370;
              var r = Math.round(Math.random() * 10);
              var red = Math.round(Math.random() * 255);
              var green = Math.round(Math.random() * 255);
              var blue = Math.round(Math.random() * 255);
              var tran = Math.random();
              var deg = 0;
              var startX = x;
              var startY = y;
              var stepX = Math.random() * 20 + 10;
              var stepY = 50;
              arr.push({
                x: x,
                y: y,
                r: r,
                red: red,
                green: green,
                blue: blue,
                tran: 1,
                deg: deg,
                startX: startX,
                startY: startY,
                stepX: stepX,
                stepY: stepY,
              });
            }, 100);

            // 绘制圆
            // var deg = 0;
            // var stepX = 1;
            // var stepY = 100;
            timer2 = setInterval(() => {
              // console.log(arr);
              ctx.clearRect(0, 0, oc.width, oc.height);
              for (let i = 0; i < arr.length; i++) {
                arr[i].deg += 5;
                arr[i].y =
                  arr[i].startY - ((arr[i].deg * Math.PI) / 180) * arr[i].stepY;
                // console.log(arr[i].y);
                arr[i].x =
                  arr[i].startX +
                  Math.sin((arr[i].deg * Math.PI) / 180) * arr[i].stepX;
                // console.log(arr[i].x);
                if (arr[i].tran <= 0) {
                  arr.splice(i, 1);
                }
                arr[i].tran -= 0.002;
              }
              for (let i = 0; i < arr.length; i++) {
                ctx.save();
                ctx.fillStyle = `rgba(${arr[i].red},${arr[i].green},${arr[i].blue},${arr[i].tran})`;
                ctx.beginPath();
                ctx.arc(arr[i].x, arr[i].y, arr[i].r, 0, 2 * Math.PI);
                ctx.fill();
                ctx.restore();
              }
            }, 1000 / 60);
          }
        }
      }

      // 06-第四屏图片拼接切换效果
      picBoom();
      function picBoom() {
        for (let i = 0; i < about3UlLists.length; i++) {
          change(about3UlLists[i]);
        }
        function change(ul) {
          // 从data-src中获取数据
          var src = ul.dataset.src;
          // 记录ul的宽高的一半，为了给图片进行定位
          var w = ul.offsetWidth / 2;
          var h = ul.offsetHeight / 2;
          for (let i = 0; i < 4; i++) {
            // 创建li节点
            var liNode = document.createElement("li");
            // 为li节点设置宽高
            liNode.style.width = w + "px";
            liNode.style.height = h + "px";
            // 创建img节点
            var imgNode = document.createElement("img");

            // 通过取余和除法运算进行定位
            /*
              1. left: 0 ,top: 0;
              2. left: w ,top: 0;
              3. left: 0, top: -h;
              4. left: -w,top: -h
            */
            imgNode.style.left = -(i % 2) * w + "px";
            imgNode.style.top = -Math.floor(i / 2) * h + "px";

            imgNode.src = src;
            // 将img节点加在li节点下
            liNode.appendChild(imgNode);
            // 将li节点加在ul节点下
            ul.appendChild(liNode);
          }
          ul.onmouseenter = function () {
            console.log(this);
            var imgNodes = this.querySelectorAll("li > img");
            /*
              1. left: 0 ,top: h;
              2. left: -2w ,top: 0;
              3. left: w, top: -h;
              4. left: -w,top: -2h
            */
            imgNodes[0].style.left = 0 + "px";
            imgNodes[0].style.top = h + "px";
            imgNodes[1].style.left = -2 * w + "px";
            imgNodes[1].style.top = 0 + "px";
            imgNodes[2].style.left = w + "px";
            imgNodes[2].style.top = -h + "px";
            imgNodes[3].style.left = -w + "px";
            imgNodes[3].style.top = -2 * h + "px";
          };
          ul.onmouseleave = function () {
            var imgNodes = this.querySelectorAll("li > img");
            /*
              1. left: 0 ,top: 0;
              2. left: w ,top: 0;
              3. left: 0, top: -h;
              4. left: -w,top: -h
            */
            imgNodes[0].style.left = 0 + "px";
            imgNodes[0].style.top = 0 + "px";
            imgNodes[1].style.left = -w + "px";
            imgNodes[1].style.top = 0 + "px";
            imgNodes[2].style.left = 0 + "px";
            imgNodes[2].style.top = -h + "px";
            imgNodes[3].style.left = -w + "px";
            imgNodes[3].style.top = -h + "px";
          };
        }
      }

      // 05-第一屏交互效果
      var oldIndex = 0;
      var timer3D = 0;
      var autoIndex = 0;
      home3D();
      function home3D(params) {
        for (let i = 0; i < home2LiNodes.length; i++) {
          // 绑定点击事件
          home2LiNodes[i].onclick = function () {
            clearInterval(timer3D);
            console.log(timer3D);
            for (let i = 0; i < home2LiNodes.length; i++) {
              home2LiNodes[i].classList.remove("active");
            }
            this.classList.add("active");

            //从左往右 当前索引大于上一次 rightShow leftHide
            if (i > oldIndex) {
              home1LiNodes[i].classList.remove("rightHide");
              home1LiNodes[i].classList.remove("leftHide");
              home1LiNodes[i].classList.remove("leftShow");
              home1LiNodes[i].classList.add("rightShow");

              home1LiNodes[oldIndex].classList.remove("rightHide");
              home1LiNodes[oldIndex].classList.remove("rightShow");
              home1LiNodes[oldIndex].classList.remove("leftShow");
              home1LiNodes[oldIndex].classList.add("leftHide");
            }

            //从右往左 当前索引小于上一次
            if (i < oldIndex) {
              home1LiNodes[i].classList.remove("rightHide");
              home1LiNodes[i].classList.remove("leftHide");
              home1LiNodes[i].classList.remove("rightShow");
              home1LiNodes[i].classList.add("leftShow");

              home1LiNodes[oldIndex].classList.remove("leftHide");
              home1LiNodes[oldIndex].classList.remove("rightShow");
              home1LiNodes[oldIndex].classList.remove("leftShow");
              home1LiNodes[oldIndex].classList.add("rightHide");
            }

            oldIndex = i;
            autoIndex = i;

            // 重新开启定时器
            move();
          };
        }
        move();
        // 从左向右自动轮播
        function move() {
          clearInterval(timer);
          timer3D = setInterval(() => {
            autoIndex++;
            if (autoIndex === home1LiNodes.length) {
              autoIndex = 0;
            }
            home1LiNodes[autoIndex].classList.remove("rightHide");
            home1LiNodes[autoIndex].classList.remove("leftHide");
            home1LiNodes[autoIndex].classList.remove("leftShow");
            home1LiNodes[autoIndex].classList.add("rightShow");
            home2LiNodes[autoIndex].classList.add("active");

            home1LiNodes[oldIndex].classList.remove("rightHide");
            home1LiNodes[oldIndex].classList.remove("rightShow");
            home1LiNodes[oldIndex].classList.remove("leftShow");
            home1LiNodes[oldIndex].classList.add("leftHide");
            home2LiNodes[oldIndex].classList.remove("active");

            oldIndex = autoIndex;
          }, 3000);
        }
        // 移入停止滚动
        home1.onmouseenter = function () {
          clearInterval(timer3D);
        };
        // 移出继续滚动
        home1.onmouseleave = function () {
          move();
        };
      }

      // 04-内容区交互——滚轮
      if (content.addEventListener) {
        content.addEventListener("DOMMouseScroll", (ev) => {
          ev = ev || event;
          clearTimeout(timer);
          timer = setTimeout(() => {
            fn(ev);
          }, 200);
        });
      }
      content.onmousewheel = function (ev) {
        ev = ev || event;
        clearTimeout(timer);
        timer = setTimeout(() => {
          fn(ev);
        }, 200);
      };
      function fn(ev) {
        // ev = ev || event;
        var dir = "";
        if (ev.wheelDelta) {
          dir = ev.wheelDelta > 0 ? "up" : "down";
        } else if (ev.detail) {
          dir = ev.wheelDelta < 0 ? "up" : "down";
        }
        preI = now;
        console.log(preI);
        switch (dir) {
          case "up":
            if (now > 0) {
              now--;
              move(now);
            }

            break;
          case "down":
            if (now < cLiNodes.length - 1) {
              now++;
              move(now);
            }

            break;
        }
      }

      // 03-调整分辨率时的适配
      window.onresize = function () {
        contentBind();
        cList.style.top =
          -now * (document.documentElement.clientHeight - head.offsetHeight) +
          "px";
        arrow.style.left =
          liNodes[now].offsetLeft +
          liNodes[now].offsetWidth / 2 -
          arrow.offsetWidth / 2 +
          "px";
      };

      // 02-绑定内容区交互事件
      contentBind();
      function contentBind() {
        content.style.height =
          document.documentElement.clientHeight - head.offsetHeight + "px";
        for (let i = 0; i < cLiNodes.length; i++) {
          cLiNodes[i].style.height =
            document.documentElement.clientHeight - head.offsetHeight + "px";
        }
      }

      // 01-绑定头部交互事件
      headBind();
      function headBind() {
        // 首屏打开时箭头移动到home标签下
        firstUpNode.style.width = "100%";
        arrow.style.left =
          firstLiNode.offsetLeft +
          firstLiNode.offsetWidth / 2 -
          arrow.offsetWidth / 2 +
          "px";
        // 设置点击标签时箭头的移动和标签样式的改变
        for (let i = 0; i < liNodes.length; i++) {
          liNodes[i].onclick = function () {
            preI = now;
            move(i);
            now = i;
          };
        }
        // 设置右侧圆点点击切换屏幕
        for (let i = 0; i < dotList.length; i++) {
          dotList[i].onclick = function () {
            preI = now;
            move(i);
            now = i;
          };
        }
      }
      // 小箭头移动和图标样式变换函数
      function move(i) {
        for (let j = 0; j < upNodes.length; j++) {
          upNodes[j].style.width = "";
        }
        upNodes[i].style.width = "100%";
        arrow.style.left =
          liNodes[i].offsetLeft +
          liNodes[i].offsetWidth / 2 -
          arrow.offsetWidth / 2 +
          "px";
        cList.style.top =
          -i * (document.documentElement.clientHeight - head.offsetHeight) +
          "px";

        for (let j = 0; j < dotList.length; j++) {
          dotList[j].className = "";
        }
        dotList[i].className = "active";

        // 出入场
        if(animation[i] && typeof animation[i]["inAn"] === "function"){
          animation[i].inAn();
        }
        if(animation[preI] && typeof animation[preI]["inAn"] === "function"){
          animation[preI].outAn();
        }
        
      }
    };
  </script>
</html>
